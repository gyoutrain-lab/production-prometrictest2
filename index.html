<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nursing Prometric Actual Simulation Test</title>

<meta property="og:title" content="Nursing Prometric Actual Simulation Test">
<meta property="og:description" content="Prepared based on the Prometric/SMLE and ENCLEX prometric test materials. Increase your knowledge for your smart career tracking.">
<meta property="og:image" content="https://raw.githubusercontent.com/gyoutrain-lab/production-prometrictest2/main/assets/icon17%20(7).jpg">

<style>
body { font-family: Arial, sans-serif; background:#eef5f5; text-align:center; margin:0; }

/* Floating animation background */
header {
  position:relative; width:100%; height:50vh; overflow:hidden;
}
header::before, header::after {
  content:""; position:absolute; top:0; left:0; width:100%; height:100%;
  background:url('https://raw.githubusercontent.com/gyoutrain-lab/production-prometrictest2/main/assets/icon17%20(7).jpg') center/cover no-repeat;
  opacity:0.08;
}
header::before{ animation: wave1 8s infinite alternate ease-in-out; }
header::after{ animation: wave2 10s infinite alternate ease-in-out; }

@keyframes wave1 {0%{transform:translate(0,0);}50%{transform:translate(15px,-10px);}100%{transform:translate(0,0);}}
@keyframes wave2 {0%{transform:translate(0,0);}50%{transform:translate(-20px,-12px);}100%{transform:translate(0,0);}}

header img { position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); max-height:250px; }

h1 { font-size:2em; color:#007b83; margin-top:20px; }
.social-icons img { width:35px; margin:0 6px; }

.buttons-center { margin:20px; display:flex; justify-content:center; gap:15px; }
.buttons-center button { padding:10px 18px; border-radius:5px; border:none; color:white; cursor:pointer; }
.confirm { background:#007b83; }
.continue { background:#28a745; }

form {
  position:fixed; bottom:20px; left:20px; width:270px;
  background:white; padding:14px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.2);
}
form input { width:100%; padding:8px; margin-top:6px; }

.qr-container {
  position:fixed; bottom:20px; right:20px; width:140px;
  background:white; padding:10px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.2);
}
</style>
</head>
<body>

<header>
  <img src="https://raw.githubusercontent.com/gyoutrain-lab/production-prometrictest2/main/assets/icon17%20(7).jpg">
</header>

<h1>Nursing Prometric Actual Simulation Test</h1>
<h2>Prepared based on the Prometric/SMLE and ENCLEX test materials</h2>
<h2>Increase your knowledge for your smart career tracking</h2>

<div class="social-icons">
  <a href="https://wa.me/6285399652487" target="_blank"><img src="https://cdn-icons-png.flaticon.com/512/733/733585.png"></a>
</div>

<div class="buttons-center">
  <button class="confirm" id="btnConfirm">Confirmation</button>
  <button class="continue" id="btnContinue">Continue Test</button>
</div>

<form id="unlockForm">
<label>Name</label><input id="name" type="text">

<label>WhatsApp Number</label><input id="whatsapp" type="text">

<label>Unlock Code</label><input id="code" type="text">
</form>

<div class="qr-container">
  <img src="https://raw.githubusercontent.com/gyoutrain-lab/production-prometrictest2/main/assets/dana_qr.png">
</div>

<!-- =========================== SCRIPT IMPROVED ============================ -->
<script>
// Google Script endpoint
const SHEET_URL = "https://script.google.com/macros/s/AKfycbzLIWMwSfR-n10vdk7T05QETYe2Om18iD2dIHN79ksFvaKyJ1-gUPNIX6tqXMtO_8XN/exec";

// Elements
const inputName = document.getElementById("name");
const inputWA = document.getElementById("whatsapp");
const inputCode = document.getElementById("code");

// Generate/Store Device ID
async function getDeviceID(){
  let id = localStorage.getItem("device_id");
  if(!id){
    id = crypto.randomUUID();
    localStorage.setItem("device_id", id);
  }
  return id;
}

// Auto-restore previous typing
window.onload = () => {
  inputName.value = localStorage.getItem("inputName") || "";
  inputWA.value = localStorage.getItem("inputWA") || "";
  inputCode.value = localStorage.getItem("inputCode") || "";
};

// Auto-save while typing
[inputName,inputWA,inputCode].forEach(el=>{
  el.addEventListener("input",()=>{
    localStorage.setItem(el.id === "name" ? "inputName" :
      el.id === "whatsapp" ? "inputWA" : "inputCode", el.value);
  });
});

// Confirmation (No unlock needed)
document.getElementById("btnConfirm").onclick = async () =>{
  if(!inputName.value.trim() || !inputWA.value.trim()){
    alert("Fill Name and WhatsApp first.");
    return;
  }

  const res = await fetch(SHEET_URL,{
    method:"POST",
    body:JSON.stringify({
      action:"confirmation",
      name:inputName.value.trim(),
      whatsapp:inputWA.value.trim(),
      deviceId:await getDeviceID()
    })
  });

  const data = await res.json();
  alert(data.message);
  if(data.waNotify) window.open(data.waNotify,"_blank");
};

// Continue Test with verification
document.getElementById("btnContinue").onclick = async ()=>{

  if(!inputName.value.trim() || !inputWA.value.trim()){
    alert("Fill Name and WhatsApp first.");
    return;
  }

  if(!inputCode.value.trim()){
    alert("Enter unlock code.");
    return;
  }

  const response = await fetch(SHEET_URL,{
    method:"POST",
    body:JSON.stringify({
      action:"verifyUnlock",
      name:inputName.value.trim(),
      whatsapp:inputWA.value.trim(),
      code:inputCode.value.trim(),
      deviceId:await getDeviceID()
    })
  });

  const result = await response.json();

  if(result.ok){
    alert("Access Granted âœ” Redirecting...");
    localStorage.setItem("authorized","yes");
    window.location.href = result.testGroupUrl;
  } else {
    alert(result.message || "Unlock failed.");
  }
};
</script>
</body>
</html>
