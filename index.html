<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Nursing Prometric Actual Simulation Test</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>

<div class="container">
  <div class="card header">
    <div>
      <div class="title">ğŸ©º Nursing Prometric Actual Simulation Test</div>
      <div class="subtitle">500 tricky & hard items â€” Prometric / SMLE / NCLEX based</div>
    </div>
    <div>
      <button class="btn btn-ghost" onclick="location.href='admin.html'">Admin</button>
    </div>
  </div>

  <img src="https://images.unsplash.com/photo-1587502536263-43f2b7d5b6b1?q=80&w=1600&auto=format&fit=crop&ixlib=rb-4.0.3&s=9f7b9b9a1f8c3b3f0f7dd4b6e4e5b0f8" class="hero card">

  <div style="margin-top:18px" class="card">
    <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
      <div>
        <div style="font-weight:800;font-size:18px;color:#083d58">Start practicing and master your exam.</div>
        <div style="color:#6b7280;margin-top:6px;font-size:14px">Demo available â€” Full test unlock after confirmation & admin approval.</div>
      </div>
      <div style="text-align:right">
        <button class="btn btn-primary" onclick="location.href='quiz.html?demo=true'">ğŸš€ Start Demo Test</button>
        <div style="height:8px"></div>
        <button class="btn" id="unlockBtn">ğŸ” Continue Full Test</button>
      </div>
    </div>
  </div>

  <div style="margin-top:18px" class="card grid">
    <div>
      <div style="font-weight:700;color:#083d58">How it works</div>
      <ol style="color:#6b7280;margin-top:8px;padding-left:18px">
        <li>Click Continue Full Test â†’ register your Name & WhatsApp</li>
        <li>Send proof to admin (WhatsApp) and wait approval</li>
        <li>Admin approves sheet â†’ system unlocks automatically</li>
      </ol>
    </div>

    <div>
      <div style="font-weight:700;color:#083d58">Support</div>
      <p style="color:#6b7280;margin-top:8px">
        Contact admin via WhatsApp:
        <a href="https://wa.me/6285399652487" target="_blank">+62 853-9965-2487</a>
      </p>
    </div>
  </div>

  <div id="registerBox" class="card" style="display:none; margin-top:18px;">
    <h3>ğŸ” Unlock Full Access</h3>
    <p>Fill and send confirmation.</p>

    <input id="name" placeholder="Your Name">
    <input id="wa" placeholder="WhatsApp Number">

    <button class="btn btn-primary" id="confirmBtn">ğŸ“© Confirm Payment</button>
  </div>

  <div class="footer" style="text-align:center;margin-top:18px">
    Prepared by <strong>Giyono Asfarrasyid â€” ETK Yogyakarta</strong>
  </div>
</div>

<script>
// ====== CONFIG ======
const SHEET_URL = "https://script.google.com/macros/s/AKfycbz7sGiwozuqKkcN9QKn3LauEq8Q7LvR_hdDKsEgfcuJ0ywyL8bxMpwP_UIS7FUlD88j/exec";
const adminWA = "6285399652487";

// Device ID
async function getDeviceId() {
  let id = localStorage.getItem("deviceId");
  if (!id) {
    id = crypto.randomUUID();
    localStorage.setItem("deviceId", id);
  }
  return id;
}

// Show register form on click
document.getElementById("unlockBtn").addEventListener("click", () => {
  document.getElementById("registerBox").style.display = "block";
});

// Confirm Payment
document.getElementById("confirmBtn").addEventListener("click", async () => {
  const name = document.getElementById("name").value.trim();
  const wa = document.getElementById("wa").value.trim();
  const deviceId = await getDeviceId();

  if (!name || !wa) {
    alert("âš  Please enter your Name and WhatsApp number.");
    return;
  }

  const payload = { action:"confirmation", name, whatsapp:wa, deviceId };

  fetch(SHEET_URL, { method:"POST", body:JSON.stringify(payload) })
    .then(res => res.json())
    .then(data => {
      if(data.ok) {
        alert("ğŸ“© Confirmation sent. Admin will verify.");
        // Save to localStorage for quiz.html
        localStorage.setItem("name", name);
        localStorage.setItem("wa", wa);
        localStorage.setItem("unlockCode", "000000"); // placeholder, updated after admin approves
        // Open WhatsApp to notify admin
        const msg = encodeURIComponent(`Payment Confirmed.\n\nName: ${name}\nWhatsApp: ${wa}\nDevice ID: ${deviceId}\n\nPlease verify & send unlock code.`);
        window.open(`https://wa.me/${adminWA}?text=${msg}`, "_blank");
      } else {
        alert(data.message || "Error during confirmation.");
      }
    })
    .catch(err => alert("Error: " + err.message));
});
</script>

</body>
</html>
